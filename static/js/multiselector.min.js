!function(e){"use strict";e.selectator=function(t,n){var i={prefix:"selectator_",height:"auto",useDimmer:!1,useSearch:!0,showAllOptionsOnFocus:!1,selectFirstOptionOnSearch:!0,keepOpen:!1,submitCallback:function(){},load:null,delay:0,minSearchLength:0,valueField:"value",textField:"text",searchFields:["value","text"],placeholder:"",render:{selected_item:function(e,t){var n="";return void 0!==e.left&&(n+='<div class="'+o.options.prefix+'selected_item_left"><img src="'+t(e.left)+'"></div>'),void 0!==e.right&&(n+='<div class="'+o.options.prefix+'selected_item_right">'+t(e.right)+"</div>"),n+='<div class="'+o.options.prefix+'selected_item_title">'+(void 0!==e.text?t(e.text):"")+"</div>",void 0!==e.subtitle&&(n+='<div class="'+o.options.prefix+'selected_item_subtitle">'+t(e.subtitle)+"</div>"),n+='<div class="'+o.options.prefix+'selected_item_remove">X</div>'},option:function(e,t){var n="";return void 0!==e.left&&(n+='<div class="'+o.options.prefix+'option_left"><img src="'+t(e.left)+'"></div>'),void 0!==e.right&&(n+='<div class="'+o.options.prefix+'option_right">'+t(e.right)+"</div>"),n+='<div class="'+o.options.prefix+'option_title">'+(void 0!==e.text?t(e.text):"")+"</div>",void 0!==e.subtitle&&(n+='<div class="'+o.options.prefix+'option_subtitle">'+t(e.subtitle)+"</div>"),n}},labels:{search:"Search..."}},o=this;o.options={},o.$source_element=e(t),o.$container_element=null,o.$selecteditems_element=null,o.$input_element=null,o.$textlength_element=null,o.$options_element=null,o.usefilterResults=!0;var s=void 0===o.$source_element.attr("multiple"),l=!s,a=!1,r=!0,p=null,c=8,d=9,u=13,m=16,h=27,_=37,f=38,v=39,$=40;o.init=function(){if(o.options=e.extend(!0,{},i,n),e.each(o.$source_element.data(),function(e,t){"selectator"==e.substring(0,10)&&(o.options[e.substring(10,11).toLowerCase()+e.substring(11)]=t)}),o.options.searchFields="string"==typeof o.options.searchFields?o.options.searchFields.split(" "):o.options.searchFields,o.$source_element.find("option").each(function(){e(this).data("value",this.value),e(this).data("text",this.text)}),a=null!==o.options.load,o.options.useDimmer&&0===e("#"+o.options.prefix+"dimmer").length){var t=e(document.createElement("div"));t.attr("id",o.options.prefix+"dimmer"),t.hide(),e(document.body).prepend(t)}o.$source_element.addClass("selectator"),o.$source_element.attr("placeholder")&&(o.options.placeholder=o.$source_element.attr("placeholder")),o.$container_element=e(document.createElement("div")),void 0!==o.$source_element.attr("id")&&o.$container_element.attr("id",o.options.prefix+o.$source_element.attr("id")),o.$container_element.addClass(o.options.prefix+"element "+(l?"multiple ":"single ")+"options-hidden"),o.options.useSearch||o.$container_element.addClass("disable_search"),o.$container_element.css({width:o.$source_element.css("width"),minHeight:o.$source_element.css("height"),padding:o.$source_element.css("padding"),"flex-grow":o.$source_element.css("flex-grow"),position:"relative"}),"element"===o.options.height&&o.$container_element.css({height:o.$source_element.outerHeight()+"px"}),o.$textlength_element=e(document.createElement("span")),o.$textlength_element.addClass(o.options.prefix+"textlength"),o.$textlength_element.css({position:"absolute",visibility:"hidden"}),o.$container_element.append(o.$textlength_element),o.$selecteditems_element=e(document.createElement("div")),o.$selecteditems_element.addClass(o.options.prefix+"selected_items"),o.$container_element.append(o.$selecteditems_element),o.$input_element=e(document.createElement("input")),o.$input_element.addClass(o.options.prefix+"input"),o.$input_element.attr("tabindex",o.$source_element.attr("tabindex")),o.options.useSearch?s?o.$input_element.attr("placeholder",o.options.labels.search):(""!=o.options.placeholder&&o.$input_element.attr("placeholder",o.options.placeholder),o.$input_element.width(20)):(o.$input_element.attr("readonly",!0),o.$input_element.css({width:"0px",height:"0px",overflow:"hidden",border:0,padding:0,position:"absolute"})),o.$input_element.attr("autocomplete","false"),o.$container_element.append(o.$input_element),o.$options_element=e(document.createElement("ul")),o.$options_element.addClass(o.options.prefix+"options"),o.$container_element.append(o.$options_element),o.$source_element.after(o.$container_element),o.$source_element.hide(),"undefined"!=typeof Scrollator&&o.$options_element.scrollator({zIndex:1001,customClass:"ease_preventOverlay"}),o.$source_element.change(function(){x()}),o.$container_element.on("focus",function(){o.$input_element.focus(),o.$input_element.trigger("focus")}),o.$container_element.on("mousedown",function(e){if(e.preventDefault(),o.$input_element.focus(),o.$input_element.trigger("focus"),o.$input_element[0].setSelectionRange)o.$input_element[0].setSelectionRange(o.$input_element.val().length,o.$input_element.val().length);else if(o.$input_element[0].createTextRange){var t=o.$input_element[0].createTextRange();t.collapse(!0),t.moveEnd("character",o.$input_element.val().length),t.moveStart("character",o.$input_element.val().length),t.select()}}),o.$container_element.on("click",function(){o.$input_element.focus(),o.$input_element.trigger("focus")}),o.$container_element.on("dblclick",function(){o.$input_element.select(),o.$input_element.trigger("focus")}),o.$input_element.on("keydown",function(e){var t=null,n=null;switch(e.keyCode||e.which){case f:e.preventDefault(),k(),0!==(t=o.$options_element.find(".active")).length?(n=t.prevUntil("."+o.options.prefix+"option:visible").add(t).first().prev("."+o.options.prefix+"option:visible"),t.removeClass("active"),n.addClass("active")):o.$options_element.find("."+o.options.prefix+"option").filter(":visible").last().addClass("active"),F();break;case $:e.preventDefault(),k(),0!==(t=o.$options_element.find(".active")).length?(n=t.nextUntil("."+o.options.prefix+"option:visible").add(t).last().next("."+o.options.prefix+"option:visible"),t.removeClass("active"),n.addClass("active")):o.$options_element.find("."+o.options.prefix+"option").filter(":visible").first().addClass("active"),F();break;case h:e.preventDefault();break;case u:e.preventDefault(),0!==(t=o.$options_element.find(".active")).length?D():""!==o.$input_element.val()&&o.options.submitCallback(o.$input_element.val()),g();break;case c:if(o.options.useSearch){if(""===o.$input_element.val()&&l&&o.$source_element.find("option:selected").length){var i=o.$source_element.find("option:selected").last()[0];i.removeAttribute("selected"),i.selected=!1,o.$source_element.trigger("change"),x()}g()}else e.preventDefault();break;default:g()}}),o.$input_element.on("keyup",function(e){e.preventDefault(),e.stopPropagation();var t=e.which;switch(t){case h:S();break;case u:o.options.keepOpen||S();break;case _:case v:case f:case $:case d:case m:break;default:w()}!o.$container_element.hasClass("options-hidden")||t!==_&&t!==v&&t!==f&&t!==$||k(),g()}),o.$input_element.on("focus",function(){o.$container_element.addClass("focused"),(s||o.options.showAllOptionsOnFocus||!o.options.useSearch)&&k()}),o.$input_element.on("blur",function(){o.$container_element.removeClass("focused"),S()}),o.$container_element.on("mouseup","."+o.options.prefix+"selected_item_remove",function(){var t=e(this).closest("."+o.options.prefix+"selected_item").data("source_item_element");if(t.removeAttribute("selected"),t.selected=!1,s&&o.$source_element.find('[value=""]').length){var n=o.$source_element.find('[value=""]')[0];n.setAttribute("selected",""),n.selected=!0}o.$source_element.trigger("change"),y(o.usefilterResults),b(),x()}),o.$container_element.on("mouseover","."+o.options.prefix+"option",function(){o.$options_element.find(".active").removeClass("active"),e(this).addClass("active")}),o.$container_element.on("mousedown","."+o.options.prefix+"option",function(e){e.preventDefault(),e.stopPropagation()}),o.$container_element.on("mouseup","."+o.options.prefix+"option",function(){D()}),o.$container_element.on("click","."+o.options.prefix+"option",function(e){e.stopPropagation()}),o.options.$source_element=o.$source_element,o.options.$container_element=o.$container_element,o.options.$selecteditems_element=o.$selecteditems_element,o.options.$input_element=o.$input_element,o.options.$textlength_element=o.$textlength_element,o.options.$options_element=o.$options_element,b(),x(),g()};var g=function(){if(l){o.$textlength_element.text(""===o.$input_element.val()&&""!==o.options.placeholder?o.options.placeholder:o.$input_element.val());var e=o.$textlength_element.width()>o.$container_element.width()-30?o.$container_element.width()-30:o.$textlength_element.width()+30;o.$input_element.css({width:e+"px"})}},x=function(){o.$selecteditems_element.empty(),o.$source_element.find("option").each(function(){var t=e(this);if(this.selected){var n=e(document.createElement("div"));n.data("source_item_element",this),n.addClass(o.options.prefix+"selected_item"),n.addClass(o.options.prefix+"value_"+t.val().replace(/\W/g,"")),void 0!==t.attr("class")&&n.addClass(t.attr("class"));var i={value:this.value,text:this.text};e.each(this.attributes,function(){this.specified&&(i[this.name.replace("data-","")]=this.value)}),e.extend(i,e(this).data("item_data")),n.append(o.options.render.selected_item(i,O)),!s||""!=i[o.options.valueField]&&void 0!==i[o.options.valueField]&&0!==o.$source_element.find('[value=""]').length||n.find("."+o.options.prefix+"selected_item_remove").remove(),o.$selecteditems_element.append(n)}}),s&&(""==o.options.placeholder||""!==o.$source_element.val()&&null!==o.$source_element.val()?o.$selecteditems_element.find("."+o.options.prefix+"placeholder").remove():(o.$selecteditems_element.empty(),o.$selecteditems_element.append('<div class="'+o.options.prefix+'placeholder">'+o.options.placeholder+"</div>")))},b=function(){o.$options_element.empty();var t=[];o.$source_element.children().each(function(){if("optgroup"===e(this).prop("tagName").toLowerCase()){var n=e(this);if(0!==n.children("option").length){var i=[];n.children("option").each(function(){i.push({type:"option",text:e(this).html(),element:this})}),t.push({type:"group",text:n.attr("label"),options:i,element:n})}}else t.push({type:"option",text:e(this).html(),element:this})}),e(t).each(function(){if("group"===this.type){var t=e(document.createElement("li"));t.addClass(o.options.prefix+"group"),void 0!==e(this.element).attr("class")&&t.addClass(e(this.element).attr("class")),t.html(e(this.element).attr("label")),o.$options_element.append(t),e(this.options).each(function(){var e=C.call(this.element,!0);o.$options_element.append(e)})}else{var n=C.call(this.element,!1);o.$options_element.append(n)}}),y(o.usefilterResults)},C=function(t){var n=e(document.createElement("li"));n.data("source_option_element",this),n.addClass(o.options.prefix+"option"),n.addClass(o.options.prefix+"value_"+e(this).val().replace(/\W/g,"")),t&&n.addClass(o.options.prefix+"group_option"),this.selected&&n.addClass("active"),void 0!==e(this).attr("class")&&n.addClass(e(this).attr("class"));var i={value:this.value,text:this.text};return e.each(this.attributes,function(){this.specified&&(i[this.name.replace("data-","")]=this.value)}),e.extend(i,e(this).data("item_data")),l&&this.selected&&n.hide(),n.append(o.options.render.option(i,O)),n},w=function(){clearTimeout(p),p=setTimeout(function(){o.$container_element.addClass("loading"),a?o.options.load(o.$input_element.val(),function(t,n){if(o.usefilterResults=void 0!==n&&n,o.$source_element.children("option").not(":selected").not('[value=""]').remove(),void 0!==t){var i=[];if(e.each(o.$source_element.children("option:selected"),function(e,t){i.push(t.value)}),s&&0===o.$source_element.find('[value=""]').length&&o.$source_element.prepend(e('<option value="">&nbsp;</option>')),o.$input_element.val().replace(/\s/g,"").length>=o.options.minSearchLength)for(var l=0;l<t.length;l++){var a=t[l];if(-1===e.inArray(a[o.options.valueField]+"",i)){var r=e('<option value="'+a[o.options.valueField]+'">'+a[o.options.textField]+"</option>");o.$source_element.append(r),r.data("item_data",a)}}}b(),o.$container_element.removeClass("loading"),y(o.usefilterResults)}):(o.$container_element.removeClass("loading"),y(o.usefilterResults))},o.options.delay)},y=function(t){t=void 0!==t&&t;var n=o.$input_element.val().replace(/\s/g,"").length<o.options.minSearchLength;r=!1;var i=o.$input_element.val().toLowerCase();o.$options_element.find("."+o.options.prefix+"option").each(function(){var l=e(this),a=l.data("source_option_element"),p=e(a),c=!1;e.each(o.options.searchFields,function(e,t){if(void 0!==p.data(t)&&-1!==p.data(t).toString().toLowerCase().indexOf(i))return c=!0,!1}),!t&&!a.selected||t&&(!a.selected||s)&&(o.options.useSearch&&(n||c||""===p.val())||!o.options.useSearch)?(l.show(),r=r||!0):l.hide()}),o.$options_element.find("."+o.options.prefix+"group").each(function(){var t=e(this),n=!1;t.nextUntil("."+o.options.prefix+"group").each(function(){if("none"!=e(this).css("display"))return n=!0,!1}),n?t.show():t.hide()}),k(),l&&(o.$options_element.find(".active").removeClass("active"),n||o.$options_element.find("."+o.options.prefix+"option").filter(":visible").first().addClass("active"))},k=function(){!o.$input_element.is(":focus")||!r&&!s||o.$options_element.is(":empty")&&!o.options.useSearch?S():(o.$container_element.removeClass("options-hidden").addClass("options-visible"),o.options.useDimmer&&e("#"+o.options.prefix+"dimmer").show(),setTimeout(function(){o.$options_element.css("top",o.$container_element.outerHeight()+(l?0:o.$input_element.outerHeight())-1+"px"),"undefined"!=typeof Scrollator&&o.$options_element.data("scrollator").show()},1),F())},S=function(){o.$container_element.removeClass("options-visible").addClass("options-hidden"),"undefined"!=typeof Scrollator&&o.$options_element.data("scrollator").hide(),o.options.useDimmer&&e("#"+o.options.prefix+"dimmer").hide()},F=function(){var e=o.$options_element.find("."+o.options.prefix+"option.active");e.length>0&&o.$options_element.scrollTop(o.$options_element.scrollTop()+e.position().top-o.$options_element.height()/2+e.height()/2)},D=function(){var e=o.$options_element.find(".active");e.data("source_option_element").setAttribute("selected",""),e.data("source_option_element").selected=!0,o.$source_element.trigger("change"),o.options.keepOpen||o.$input_element.val(""),y(o.usefilterResults),x(),g(),a&&!o.options.keepOpen&&(o.$source_element.children("option").not(":selected").not('[value=""]').remove(),b(),S()),o.options.keepOpen||S()},O=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};o.refresh=function(){x()},o.destroy=function(){o.$container_element.remove(),e.removeData(t,"selectator"),o.$source_element.show(),0===e("."+o.options.prefix+"element").length&&e("#"+o.options.prefix+"dimmer").remove()},o.init()},e.fn.selectator=function(t){var n=void 0!==t?t:{};return this.each(function(){var t=e(this);if("object"==typeof n){if(void 0===t.data("selectator")){var i=new e.selectator(this,n);t.data("selectator",i)}}else t.data("selectator")[n]?t.data("selectator")[n].apply(this,Array.prototype.slice.call(arguments,1)):e.error("Method "+n+" does not exist in $.selectator")})}}(jQuery),$(function(){"use strict";$(".selectator").each(function(){var e=$(this),t={};$.each(e.data(),function(e,n){"selectator"==e.substring(0,10)&&(t[e.substring(10,11).toLowerCase()+e.substring(11)]=n)}),e.selectator(t)})});